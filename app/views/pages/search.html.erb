<div id="main">
    <div id="left">
        <!-- Search Panel -->
        <div class="row">
            <div class="col-md-offset-4 col-md-4">
                <button id="filter" class="btn btn-default" data-toggle="collapse" data-target="#collapsePanel">
                    Filters <i class="fa fa-chevron-down"></i>
                </button>
            </div>
        </div>
        <div class="row">
            <br>
            <div class = "collapse" id="collapsePanel">
                <%= search_form_for @search, url: search_path do |f|%>
                    <div class="row">
                        <div class="col-md-8">
                            <label>Price Range:</label>
                        </div>
                        <div class="col-md-2">
                            <label>Minimum Price:</label>
                            <%= f.text_field :price_gteq, class: "form-control" %>
                        </div>
                        <div class="col-md-2">
                            <label>Maximum Price:</label>
                            <%= f.text_field :price_lteq, class: "form-control" %>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-6">
                            <%= text_field_tag :start_date, params[:start_date], placeholder: "Start Date", class: "form-control datepicker" %>
                        </div>
                        <div class="col-md-6">
                            <%= text_field_tag :end_date, params[:end_date], placeholder: "End Date", class: "form-control datepicker" %>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-4">
                            <%= check_box_tag "q[room_type_eq_any][]", "Entire" %> Entire Room
                        </div>
                        <div class="col-md-4">
                            <%= check_box_tag "q[room_type_eq_any][]", "Private" %> Entire Room
                        </div>
                        <div class="col-md-4">
                            <%= check_box_tag "q[room_type_eq_any][]", "Shared" %> Entire Room
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group select">
                                <label>Guests</label>
                                <%= f.select :accomodates_gteq, [["1", 1], ["2", 2], ["3", 3], ["4", 4], ["5+", 5]], id: "accomodates", prompt: "Select", class: "form_control" %>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group select">
                                <label>Bedrooms</label>
                                <%= f.select :bedrooms_gteq, [["1", 1], ["2", 2], ["3", 3], ["4", 4], ["5+", 5]], id: "bedrooms", prompt: "Select", class: "form_control" %>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group select">
                                <label>Bathrooms</label>
                                <%= f.select :bathrooms_gteq, [["1", 1], ["2", 2], ["3", 3], ["4", 4], ["5+", 5]], id: "bathrooms", prompt: "Select", class: "form_control" %>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-4">
                            <%= check_box_tag "q[tv_eq]", true %> TV
                        </div>
                        <div class="col-md-4">
                            <%= check_box_tag "q[internet_eq]", true %> Internet
                        </div>
                        <div class="col-md-4">
                            <%= check_box_tag "q[kitchen_eq]", true %> Kitchen
                        </div>
                        <div class="col-md-4">
                            <%= check_box_tag "q[air_conditioning_eq]", true %> Air Conditioning
                        </div>
                        <div class="col-md-4">
                            <%= check_box_tag "q[heating_eq]", true %> Heating
                        </div>
                    </div>
                    <hr>
                    <div class="row text-center">
                        <%= f.submit "Search", class: "btn btn-form" %>
                    </div>

                <% end %>
            </div>
            <br>
            
            <div class="row">
                <% @roomsArr.each do |room| %>
                    <div class="col-md-4">
                        <div class="panel panel-default">
                            <div class="panel-heading preview">
                                <% if room.images.length > 0 %>
                                    <%= image_tag room.images[0], class: "img-thumbnail" %>
                                <% else %>
                                    <%= image_tag "blank.jpg", class: "img-thumbnail" %>
                                <% end %>
                            </div>
                            <div class="panel-body">
                                <%= link_to room.listing_name, room %>
                            </div>
                        </div>
                    </div>
                <% end %> 
            </div>
        </div>
    </div>
    <div id="right">
        <div id="map" style="width: 100%; height: 100%;"></div>
            <script>
                var map;
                function initMap() {
                    var location = {
                        lat: 122.2221,
                        lng: 47.5707
                    };
                    <% if @roomsArr.length > 0 %>
                        location = {lat: <%= @roomsArr[0].latitude %>, lng: <%= @roomsArr[0].longitude %>}
                    <% end %>
                    var zoom = 11;
                    map = new google.maps.Map(document.getElementById('map'), {
                    center: location,
                    zoom: zoom
                });
                <% @roomsArr.each do |room| %>
                    var marker = new google.maps.Marker({
                    position: {lat: <%= room.latitude %>, lng: <%= room.longitude %>},
                    map: map
                    });
                    var contentString = '<div id="content">$<%= room.price %></div>';
                    var infowindow = new google.maps.InfoWindow({
                    content: contentString
                    });
                    
                    marker.addListener('click', function() {
                        infowindow.open(map, marker);
                    })
                <% end %> 
                
            }
            </script>
            <script async="" defer="" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAZ_Dn5rMHkyzxbjWVa2WMn0G8OsW5EXsM&amp;callback=initMap"></script>
    </div>
</div>

<script>
    let open = true;

    $('#filter').click(() => {
        if (open) {
            $('#filter').html("Filters <i class='fa fa-chevron-up'></i>")
        } else {
            $('#filter').html("Filters <i class='fa fa-chevron-down'></i>")
        }
        open = !open;
    });
</script>